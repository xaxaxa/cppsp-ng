CPOLL_DIR := ../cpoll-ng
CPPSP_DIR := ..

CXX = @CXX@ @CXXFLAGS@ -I$(CPOLL_DIR)/include -I../include --std=c++17 -fPIC -fwrapv -fno-delete-null-pointer-checks -funsigned-char -fno-strict-aliasing -Wno-pmf-conversions -Iinclude
LDFLAGS := @LDFLAGS@ -lpthread


all: test1

$(CPOLL_DIR)/libcpoll-ng.so: FORCE
	$(MAKE) -C $(CPOLL_DIR) libcpoll-ng.so

$(CPPSP_DIR)/libcppsp-ng.so: FORCE
	$(MAKE) -C $(CPPSP_DIR) libcppsp-ng.so

FORCE:

%.o: %.C
	$(CXX) -c $(CC_FLAGS) $< -o $@

test1: test1.o $(CPOLL_DIR)/libcpoll-ng.so $(CPPSP_DIR)/libcppsp-ng.so
	$(CXX) -o $@ $^ $(LDFLAGS)


clean:
	rm -f *.o test1
